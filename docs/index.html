<html>
    <head>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
        <link rel="stylesheet" href="//cdn.jsdelivr.net/semantic-ui/2.2.8/semantic.min.css">
        <link rel="stylesheet" href="github-markdown.css">
        <style>
            .markdown-body {
                box-sizing: border-box;
                min-width: 200px;
                max-width: 980px;
                margin: 0 auto;
                padding: 45px;
            }
            .menu ul {
                padding-left: 5px;
            }
            .menu ul .header {
                font-size: 15px !important;
            }
            .menu ul a.item {
                font-size: 13px !important;
            }
            .markdown-body table {
                display: table;
            }
            table tr td:last-child {
                text-align: right;
            }
        </style>
    </head>
    <body class="ui container grid stackable">
        <div class="four wide menu column">
            <div class="ui secondary fluid vertical menu">
                <div class="item">
                    <h5 class="ui dividing header">
                        ReturButikenOnline
                        <div class="sub header">documentation</div>
                    </h5>
                </div>
                <div class="item" id="toc">
                </div>
            </div>
        </div>
        <div class="content stretched twelve wide column">
            <div class="ui segment markdown-body" id="content"></div>
        </div>

        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
        <script>
            // Function to get a resource
            var get = function(url, callback) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status == 200)
                        callback(this.responseText);
                };
                xhttp.open("GET", url, true);
                xhttp.send();
            }

            // Get the documentation tree and then init
            get('tree.json', function(response){
                initDocs(response);
            });

            // Function to initialize the documentation
            var initDocs = function(tree){
                // Make sure tree is a object
                if (typeof tree == 'string')
                    tree = JSON.parse(tree);

                // Function to display file/folder names
                var displayName = function(original){
                    var name = original;
                    // Remove ordering prefix 00_
                    if (name.indexOf('_')>0)
                        name = name.substr(name.indexOf('_')+1);
                    // Remove extension
                    if (name.indexOf('.')>0)
                        name = name.substr(0,name.lastIndexOf('.'));
                    // Replace _ with spaces
                    name = name.replace(/_/g,' ');
                    // Done
                    return name;
                }

                // Function to generate table of contents
                var generateTOC = function(o,path){
                    // Check path
                    if (!path)
                        path = '';
                    var ul = document.createElement('ul');
                        ul.classList.add('compact','vertical','menu');
                    // Folders
                    for (var key in o){
                        if (key != "files" ){
                            var header = document.createElement('div');
                                header.classList.add('header');
                                header.innerHTML = displayName(key);
                            var li = document.createElement('li');
                                li.classList.add('item');
                            li.appendChild(header);
                            li.appendChild(generateTOC(o[key],path + key+'/'));
                            ul.appendChild(li);
                        }
                    }
                    // Files
                    for (var i=0 ; i<o.files.length ; i++){
                        var a = document.createElement('a');
                            a.href = "#" + path + o.files[i];
                            a.innerHTML = displayName(o.files[i]);
                            a.classList.add('item');
                        ul.appendChild(a);
                    }
                    return ul;
                }

                // Generate TOC and append it
                var menu = document.getElementById('toc');
                menu.appendChild(generateTOC(tree.en,'en/'));

                // Get container for current file
                var reader = document.getElementById('content');

                // Function to navigate (replace content in reader)
                var navigate = function(){
                    // Get the path
                    var path = (location.hash) ? location.hash.substr(1) : '';
                    // Default page should go here. for now, do nothing
                    if (!path)
                        return location.hash = "#en/00_Home.html";
                    // Get the page
                    get(path,function(response){
                        reader.innerHTML = response;
                        // Highlight scripts using highlight.js
                        var codeblocks = document.querySelectorAll('code');
                        for (var i=0 ; i<codeblocks.length ; i++){
                            hljs.highlightBlock(codeblocks[i]);
                        }
                    })
                }

                // Listen to changes in hash
                window.onhashchange = navigate;

                // Navigate now
                navigate();
            }
        </script>
    </body>
</html>
