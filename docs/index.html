<html>
    <head>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
        <link rel="stylesheet" href="github-markdown.css">
        <style>
            .markdown-body {
                box-sizing: border-box;
                min-width: 200px;
                max-width: 980px;
                margin: 0 auto;
                padding: 45px;
            }
        </style>
    </head>
    <body class="markdown-body">
        <h3>Welcome to the ReturButikenOnline documentation!</h1>

        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
        <script>
            // Function to get a resource
            var get = function(url, callback) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status == 200)
                        callback(this.responseText);
                };
                xhttp.open("GET", url, true);
                xhttp.send();
            }

            // Get the documentation tree and then init
            get('tree.json', function(response){
                initDocs(response);
            });

            // Function to initialize the documentation
            var initDocs = function(tree){
                // Make sure tree is a object
                if (typeof tree == 'string')
                    tree = JSON.parse(tree);

                // Function to display file/folder names
                var displayName = function(original){
                    var name = original;
                    // Remove ordering prefix 00_
                    if (name.indexOf('_')>0)
                        name = name.substr(name.indexOf('_')+1);
                    // Remove extension
                    if (name.indexOf('.')>0)
                        name = name.substr(0,name.lastIndexOf('.'));
                    // Replace _ with spaces
                    name = name.replace(/_/g,' ');
                    // Done
                    return name;
                }

                // Function to generate table of contents
                var generateTOC = function(o,path){
                    // Check path
                    if (!path)
                        path = '';
                    var ul = document.createElement('ul');
                    // Folders
                    for (var key in o){
                        if (key != "files" ){
                            var li = document.createElement('li');
                                li.innerHTML = displayName(key);
                            li.appendChild(generateTOC(o[key],path + key+'/'));
                            ul.appendChild(li);
                        }
                    }
                    // Files
                    for (var i=0 ; i<o.files.length ; i++){
                        var li = document.createElement('li');
                        var a = document.createElement('a');
                            a.href = "#" + path + o.files[i];
                            a.innerHTML = displayName(o.files[i]);
                        li.appendChild(a);
                        ul.appendChild(li);
                    }
                    return ul;
                }

                // Generate TOC and append it to body
                document.body.appendChild( generateTOC(tree) );

                // Create and append container for current file
                var reader = document.createElement('div');
                document.body.appendChild(reader);

                // Function to navigate (replace content in reader)
                var navigate = function(){
                    // Get the path
                    var path = (location.hash) ? location.hash.substr(1) : '';
                    // Default page should go here. for now, do nothing
                    if (!path)
                        return;
                    // Get the page
                    get(path,function(response){
                        reader.innerHTML = response;
                        // Highlight scripts using highlight.js
                        var codeblocks = document.querySelectorAll('code');
                        for (var i=0 ; i<codeblocks.length ; i++){
                            hljs.highlightBlock(codeblocks[i]);
                        }
                    })
                }

                // Listen to changes in hash
                window.onhashchange = navigate;

                // Navigate now
                navigate();
            }
        </script>
    </body>
</html>
